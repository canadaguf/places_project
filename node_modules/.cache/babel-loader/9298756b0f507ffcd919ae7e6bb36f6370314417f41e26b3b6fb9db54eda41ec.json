{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{Button,Dialog,DialogTitle,DialogContent,DialogContentText,DialogActions}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function MapComponent(){const[selectedPlace,setSelectedPlace]=useState(null);const[map,setMap]=useState(null);const[searchControl,setSearchControl]=useState(null);const[open,setOpen]=useState(false);const[popupMessage,setPopupMessage]=useState('');useEffect(()=>{ymaps.ready(()=>{console.log('Yandex Maps API is ready');const myMap=new ymaps.Map('map',{center:[55.751426,37.618879],zoom:13,controls:[]});setMap(myMap);console.log('Map initialized');const searchControl=new ymaps.control.SearchControl({options:{provider:'yandex#search',noSuggestPanel:true}});myMap.controls.add(searchControl);setSearchControl(searchControl);console.log('Search control added');// Add event listener for search result selection\nsearchControl.events.add('resultselect',e=>{console.log('Search result selected');const index=e.get('index');searchControl.getResult(index).then(result=>{var _result$properties$ge;console.log('Search result details:',result);// Debugging: Log the properties to see what keys are available\nconsole.log('Result properties:',result.properties.getAll());const place={place_id:result.properties.get('id'),display_name:result.properties.get('name'),lat:result.geometry.getCoordinates()[1],lon:result.geometry.getCoordinates()[0],address:result.properties.get('description'),categories:result.properties.get('companyMetaData',{}).Categories.map(category=>category.name),work_hours:result.properties.get('companyMetaData',{}).Hours.text||'',phone:((_result$properties$ge=result.properties.get('companyMetaData',{}).Phones[0])===null||_result$properties$ge===void 0?void 0:_result$properties$ge.formatted)||'',url:result.properties.get('url')};// Debugging: Log the extracted place data\nconsole.log('Extracted place data:',place);setSelectedPlace(place);console.log('Selected place:',place);});});});},[]);const handleSavePlace=place=>{axios.post('http://localhost:5000/api/place-data',place).then(response=>{console.log('Response from backend:',response.data);if(response.data.status==='success'){setPopupMessage(response.data.message);setOpen(true);}}).catch(error=>{console.error('Error saving place:',error.response.data);if(error.response.data.status==='place_id exists'){setPopupMessage(error.response.data.message);setOpen(true);}else{setPopupMessage('Error saving place');setOpen(true);}});};const handleClose=()=>{setOpen(false);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{id:\"map\",style:{width:'100%',height:'500px'}}),selectedPlace&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:selectedPlace.display_name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0410\\u0434\\u0440\\u0435\\u0441: \",selectedPlace.address]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041A\\u0430\\u0442\\u0435\\u0433\\u043E\\u0440\\u0438\\u0438: \",selectedPlace.categories.join(', ')]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0412\\u0440\\u0435\\u043C\\u044F \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B: \",selectedPlace.work_hours]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0422\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D: \",selectedPlace.phone]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:()=>handleSavePlace(selectedPlace),children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C \\u0432 \\u0431\\u0430\\u0437\\u0443\"})]}),/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"alert-dialog-title\",children:\"Внимание!\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(DialogContentText,{id:\"alert-dialog-description\",children:popupMessage})}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"primary\",autoFocus:true,children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})})]})]});}export default MapComponent;","map":{"version":3,"names":["React","useEffect","useState","axios","Button","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","jsx","_jsx","jsxs","_jsxs","MapComponent","selectedPlace","setSelectedPlace","map","setMap","searchControl","setSearchControl","open","setOpen","popupMessage","setPopupMessage","ymaps","ready","console","log","myMap","Map","center","zoom","controls","control","SearchControl","options","provider","noSuggestPanel","add","events","e","index","get","getResult","then","result","_result$properties$ge","properties","getAll","place","place_id","display_name","lat","geometry","getCoordinates","lon","address","categories","Categories","category","name","work_hours","Hours","text","phone","Phones","formatted","url","handleSavePlace","post","response","data","status","message","catch","error","handleClose","children","id","style","width","height","join","variant","onClick","onClose","color","autoFocus"],"sources":["C:/Users/Ilya/places_project/src/scenes/map/MapComponent.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { Button, Dialog, DialogTitle, DialogContent, DialogContentText, DialogActions } from '@mui/material';\r\n\r\nfunction MapComponent() {\r\n  const [selectedPlace, setSelectedPlace] = useState(null);\r\n  const [map, setMap] = useState(null);\r\n  const [searchControl, setSearchControl] = useState(null);\r\n  const [open, setOpen] = useState(false);\r\n  const [popupMessage, setPopupMessage] = useState('');\r\n\r\n  useEffect(() => {\r\n    ymaps.ready(() => {\r\n      console.log('Yandex Maps API is ready');\r\n      const myMap = new ymaps.Map('map', {\r\n        center: [55.751426, 37.618879],\r\n        zoom: 13,\r\n        controls: []\r\n      });\r\n      setMap(myMap);\r\n      console.log('Map initialized');\r\n\r\n      const searchControl = new ymaps.control.SearchControl({\r\n        options: {\r\n          provider: 'yandex#search',\r\n          noSuggestPanel: true\r\n        }\r\n      });\r\n      myMap.controls.add(searchControl);\r\n      setSearchControl(searchControl);\r\n      console.log('Search control added');\r\n\r\n      // Add event listener for search result selection\r\n      searchControl.events.add('resultselect', (e) => {\r\n        console.log('Search result selected');\r\n        const index = e.get('index');\r\n        searchControl.getResult(index).then((result) => {\r\n          console.log('Search result details:', result);\r\n\r\n          // Debugging: Log the properties to see what keys are available\r\n          console.log('Result properties:', result.properties.getAll());\r\n\r\n          const place = {\r\n            place_id: result.properties.get('id'),\r\n            display_name: result.properties.get('name'),\r\n            lat: result.geometry.getCoordinates()[1],\r\n            lon: result.geometry.getCoordinates()[0],\r\n            address: result.properties.get('description'),\r\n            categories: result.properties.get('companyMetaData', {}).Categories.map(category => category.name),\r\n            work_hours: result.properties.get('companyMetaData', {}).Hours.text || '',\r\n            phone: result.properties.get('companyMetaData', {}).Phones[0]?.formatted || '',\r\n            url: result.properties.get('url')\r\n          };\r\n\r\n          // Debugging: Log the extracted place data\r\n          console.log('Extracted place data:', place);\r\n\r\n          setSelectedPlace(place);\r\n          console.log('Selected place:', place);\r\n        });\r\n      });\r\n    });\r\n  }, []);\r\n\r\n  const handleSavePlace = (place) => {\r\n    axios.post('http://localhost:5000/api/place-data', place)\r\n      .then(response => {\r\n        console.log('Response from backend:', response.data);\r\n        if (response.data.status === 'success') {\r\n          setPopupMessage(response.data.message);\r\n          setOpen(true);\r\n        }\r\n      })\r\n      .catch(error => {\r\n        console.error('Error saving place:', error.response.data);\r\n        if (error.response.data.status === 'place_id exists') {\r\n          setPopupMessage(error.response.data.message);\r\n          setOpen(true);\r\n        } else {\r\n        setPopupMessage('Error saving place');\r\n        setOpen(true);\r\n        }\r\n      });\r\n  };\r\n\r\n const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <div id=\"map\" style={{ width: '100%', height: '500px' }}></div>\r\n\r\n      {selectedPlace && (\r\n        <div>\r\n        <b>{selectedPlace.display_name}</b>\r\n        <p>Адрес: {selectedPlace.address}</p>\r\n        <p>Категории: {selectedPlace.categories.join(', ')}</p>\r\n        <p>Время работы: {selectedPlace.work_hours}</p>\r\n        <p>Телефон: {selectedPlace.phone}</p>\r\n        <Button variant=\"contained\" onClick={() => handleSavePlace(selectedPlace)}>Сохранить в базу</Button>\r\n      </div>\r\n      )}\r\n\r\n      <Dialog\r\n        open={open}\r\n        onClose={handleClose}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\">{\"Внимание!\"}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\">\r\n            {popupMessage}\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose} color=\"primary\" autoFocus>\r\n            Закрыть\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MapComponent;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}